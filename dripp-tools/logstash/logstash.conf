input {
  tcp {
    port => 5044
  }
  beats {
    port => 5001
  }
  file {
    path => "/var/log/dpkg.log"
    start_position => "beginning"
  }
}

filter {
  json {
    source => "message"
  }
  mutate {
    gsub => [
      "level", "\e\[([;\d]+)?m", ""
    ]
  }
}

output {
  elasticsearch {
    hosts => "${ELASTIC_HOSTS}"
    user => "elastic"
    password => "${ELASTIC_PASSWORD}"
    index => "logstash-%{+YYYY.MM.dd}"
  }
  stdout { codec => rubydebug }
  # if [level] == "info" {
  #   http {
  #     url => "https://sentry.io/api/4507622078021632/store/"
  #     http_method => "post"
  #     format => "json"
  #     headers => {
  #       "Content-Type" => "application/json"
  #       "X-Sentry-Auth" => "Sentry sentry_version=7,sentry_client=logstash/1.0,sentry_key=94c0e1a76a81331be0e4182fbc5c8980,sentry_secret=47498ed1d64de0b552521f4c6670fce9"
  #     }
  #     mapping => {
  #       # "event_id" => "%{[@metadata][sentry_event_id]}"
  #       "timestamp" => "%{@timestamp}"
  #       "level" => "%{level}"
  #       "logger" => "logstash"
  #       "platform" => "log"
  #       "sdk" => {
  #         "name" => "logstash"
  #         "version" => "1.0"
  #       }
  #       "message" => "%{message}"
  #     }
  #   }
  # }
}